# Post_Mortem
Finale Project 

Что произошло?
Развернутый на ЕС2-сервере AWS, стал недоступен. Во время попытки открыть сайт URL http://3.69.26.193 была ошибка:
- $wgServer must be set in LocalSettings.php See https://www.mediawiki.org/wiki/Manual:$wgServer

Причина инцидента:
Выяснилось, что одновременно возникли три основные проблемы:
- Переменная $wgServer, которая указывает, какой домен/сервер использовать для работы MediaWiki, либо не была задана,
либо содержала неправильный IP-адрес;
- Не достаточно места на /var/log;
- Смена публичного IP-адреса после перезапуска ЕС2-сервера, что вызывало переадресацию на несуществующий адрес.

Предпринятые шаги по устранению:
  1.	Подключение к серверу и попытка найти конфигурацию. Нашли нужный файл LocalSettings (5).php и скопировали его в нужную директорию: 
  cp LocalSettings) \(5\). php /var./www/html/MediaWiki/LocalSettings.php

  Перезапустили веб-сервер:
  sudo systemctl restart httpd
  
  3.	Обнаружение проблемы нехватки свободного места: - No space left on device - Это мешало открытию и редактированию конфигурационного файла
  
  Проверка использования диска: df -h 
  
  Обнаружены файлы
  /var/1og/httpd/access_log-20250804 с размером 7 GB - это и была причиной переполнения.
  
  Были удалены тяжёлые логи:
  
  sudo rm-rf /var/1og/httpd/access_10g-20250804
  
  sudo rm -rf /var/10g/httpd/access_10g-20240402
  
  После этого в системе было освобожденыо более 7 GB.
  
  4. Проблема с IP-адресом после перезапуска
  
  После перезапуска сервера был изменен IP на 18.153.51.162
  
  Проверка и редактирование файла LocalSettings. php:
  nano /var/www/html/MediaWiki/LocalSettings.php
  
  Изменена переменная:
  $wgServer = "https://18.153.51.162" на $wgServer = "http://3.69.26.193"
  
  5. Проблема с cron задачей.
  Открытие и редактирование:
  
  sudo crontab -e
  
  Закомментирована строка:
  
  #***** tar -czf /var/log/httpd/log_$(date +(%V\%m\%d).tar.gz -C /var/log/httpd (которая создаёт сжатую копию всех логов Apache за момент запуска и сохраняет её)
  
  0 3 * * * /home/ec2-user/backup_log_http.sh (Запуск скрипта резервного копирования логов каждые 3 минуты)
  
  Удалены существующие ненужные архивы:
  
  sudo rm-rf /var/10g/httpd/10g_*.tar.gz
  
  6. Настроен backup-скрипт: /home/ec2-user/backup_log_http.sh

''' #!/bin/bash

#

LOG_DIR="/var/log/httpd" (Что нужно архивировать)

BACKUP_DIR="/home/ec2-user/backup" (Директория где будут сохраняться архивы)

DATE=$(date +%Y%m%d-%H%M) 

ARCHIVE="$BACKUP_DIR/Loghttp-$DATE.tar.gz" (Полный путь и имя архива)

mkdir -p "$BACKUP_DIR" (Создана папка для бэкапа)

sudo tar -czf $ARCHIVE $LOG_DIR 

sudo systemctl stop httpd

sudo rm -rf "$LOG_DIR/access_log"

sudo systemctl start httpd

find "$BACKUP_DIR" -type f -name "Loghttp*.gz" -mtime +3 -exec rm -rf {} \; (Удаляем архивы старше 3 дней, чтобы диск не заполнялся) '''

После этого скрипт сделан исполняемым:

chmod +x backup_log_http.sh

Итог

После:
- восстановления конфигурационного файла
- удаления лишних логов
- правки IP-адреса
- исправление cron-задачи

сайт стал успешно доступен по адресу: "http://3.69.26.193"


Рекомендации на будущее:
•	Настроить мониторинг дискового пространства с автоматическими оповещениями (cron + df + mail)
•	Регулярно удалять старые логи и бэкапы
•	Проверить конфигурационные переменные при любом изменении IP-адреса
•	Добавить резервную копию файла LocalSettings.php перед изменениями
•	Автоматизировать проверку ключевых конфигураций (например, через скрипт или CI/CD)
